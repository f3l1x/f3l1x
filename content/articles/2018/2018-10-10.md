---
date: "2018-10-10"
title: "Nette 3: dependency injection"
tags: ["nette", "dependency-injection"]
slug: "nette-3-dependency-injection"
---

Jak by mohlo vypadat dependency injection v Nette 3.0.

<!--more-->

JiÅ¾ jednou jsem psal o dependency injection v Nette, konkrÃ©tnÄ› [Nette - jak zapisovat sluÅ¾by (extension / neon)](https://f3l1x.io/blog/2015/10/17/nette-jak-zapisovat-sluzby/).
Do dnes asi mÅ¯j nejlepÅ¡Ã­ ÄlÃ¡nek.

K tomuto ÄlÃ¡nku mÄ› donutily zmÄ›ny v [nette/di](https://github.com/nette/di/commits/master) repozitÃ¡Å™i. MyslÃ­m, Å¾e David zase vymyslel elegantnÃ­ features. A takÃ© tyto tweety.

<x-tweet id="1047458456041611264" user="geekovo" height="450"></x-tweet>
<x-tweet id="1047491153296330752" user="nettefw" height="450"></x-tweet>

## Nette 2.4

PojÄme si zopakovat nÄ›kterÃ© zÃ¡kladnÃ­ definice zapisovÃ¡nÃ­ sluÅ¾eb v NEONu.

**AnonymnÃ­ sluÅ¾ba**

```yaml
services:
	- App\Model\FacebookAuthenticator
```

```php
$container->getByType(App\Model\FacebookAuthenticator::class);
```

**PojmenovanÃ¡ sluÅ¾ba**

```yaml
services:
	facebookAuth: App\Model\FacebookAuthenticator
```

```php
$container->getByType(App\Model\FacebookAuthenticator::class);
$container->getService('facebookAuth');
```

**PÅ™edÃ¡vÃ¡nÃ­ zÃ¡vislostÃ­**

```yaml
services:
	- App\Model\FacebookAuthenticator(
		App\Model\MonologLogger(@monolog),
		App\Model\CacheAdapter(
			FileCache(%tempDir%/auth)
		)
	)
```

```php
$container->getByType(App\Model\FacebookAuthenticator::class);
```

**VolÃ¡nÃ­ metod na sluÅ¾bÄ›**

```yaml
services:
	facebookAuth:
		class: App\Model\FacebookAuthenticator
		setup:
			# autowiring vybere sprÃ¡vnou sluÅ¾bu
			- setLogger
			# sÃ¡m definuji konkrÃ©tnÃ­ pojmenovanou sluÅ¾bu
			- setLogger(@monologLogger)
			# sÃ¡m definuji konkrÃ©tnÃ­ anonymnÃ­ sluÅ¾bu
			- setLogger(@App\Model\MonologLogger)
```

```php
$container->getByType(App\Model\FacebookAuthenticator::class);
$container->getService('facebookAuth');
```

**VÃ­ce sluÅ¾eb stejnÃ©ho typu**

```yaml
services:
	facebookAuth:
		class: App\Model\FacebookAuthenticator
		autowired: false
	twitterAuth:
		class: App\Model\TwitterAuthenticator
		autowired: false
```

```php
$container->getService('facebookAuth');
$container->getService('twitterAuth');
```

**TagovÃ¡nÃ­**

```yaml
services:
	middleware1:
		class: App\Model\CacheMiddleware
		tags: [middleware: 100]
	middleware2:
		class: App\Model\LoggingMiddleware
		tags: [middleware: 200]
	middleware3:
		class: App\Model\ApitteMiddleware
		tags: [middleware: 300]
```

```php
$names = $container->findByTag('middleware');
foreach ($names as $name => $tag) {
	// $tag = [middleware => 100]
	$container->getService($name);
}
```

**InjectovÃ¡nÃ­**

```php
namespace App\Model;

class DatabaseAuthenticator
{
	/** @var App\Model\MonologLogger @inject */
	public $logger;
}
```

```yaml
services:
	authenticator:
		class: App\Model\DatabaseAuthenticator
		inject: true

	# alternativni zapis
	- { class: App\Model\DatabaseAuthenticator, inject: true }
```

**Extra**

```yaml
services:
	# vsechny parametry z kontejneru
	- App\Model\Foo(@container::parameters)

	# vsechny sluzby daneho typu
	- App\Model\Foo(@container::findByType(App\Model\Bar))

	# volani fce getenv()
	- App\Moel\Foo(::getenv(NODE_DEBUG))
```

## Nette 3.0+

V Nette 2.4 jdou definovat sluÅ¾by mnoha zpÅ¯soby a pÅ™i troÅ¡e cviku jste schopnÃ­ vyÅ™eÅ¡it opravdu cokoli.

Podle aktivity v nette/di bychom v Nette 3 mohli narazit na novÃ© vychytÃ¡vky.

**Autowiring pole sluÅ¾eb podle typu**

```php
namespace App\Model;

class FacebookAuthenticator
{
	/** @param AuthSubscriber[] $subscribers */
	public function __construct(array $subscribers) { ... }
}
```

```yaml
services:
	- App\Mode\CacheCleanerAuthSubscriber
	- App\Model\LoggerAuthSubscriber

	- App\Model\FacebookAuthenticator( types(App\Model\AuthSubscriber) )
```

**Autowiring pole sluÅ¾eb podle tagu**

```yaml
services:
	- { class: App\Mode\CacheCleanerAuthSubscriber, tags: [auth]}
	- { class: App\Mode\LoggerAuthSubscriber, tags: [auth]}

	- App\Model\AuthentictorMiddleware( tags(auth) )
```

**ExpandovÃ¡nÃ­ klÃ­Äe i hodnoty**

```yaml
parameters:
	username: user
	password: 1234

services:
	# [%username% => 1234] v Nette 2.4
	- Nette\Security\SimpleAuthenticator({%username%: %password%})
	# [user => 1234] v Nette 3.0+
	- Nette\Security\SimpleAuthenticator({%username%: %password%})
```

MyslÃ­m, Å¾e se mÃ¡me na co tÄ›Å¡it. Sledujte vÃ½voj! ğŸ‘€ ğŸ‰

----

A jak pouÅ¾Ã­vÃ¡te nette/di vy? NapiÅ¡te mi to do komentÃ¡Å™Å¯.
